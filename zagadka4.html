<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vertical Dodge Game</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { overflow: hidden; background: #000; }
    #game {
      position: relative;
      width: 100vw;
      height: 100vh;
      background: url('background.jpg') center/cover repeat-y;
    }
    #player {
      position: absolute;
      width: 50px;
      height: 50px;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: yellow;
      background-image: url('player.png');
      background-size: cover;
      z-index: 10;
    }
    .obstacle {
      position: absolute;
      width: 60px;
      height: 60px;
      background: red;
      background-image: url('obstacle.png');
      background-size: cover;
      z-index: 5;
    }
    .bullet {
      position: absolute;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      background-image: url('bullet.png');
      background-size: cover;
      z-index: 6;
    }
    #goal {
      position: absolute;
      width: 60px;
      height: 60px;
      background: green;
      background-image: url('goal.png');
      background-size: cover;
      z-index: 9;
    }
  </style>
</head>
<body>
  <div id="game">
    <div id="player"></div>
    <div id="goal"></div>
  </div>
  <script>
    const game = document.getElementById('game');
    const player = document.getElementById('player');
    const goal = document.getElementById('goal');
    let gameOffset = 0;
    let touchX = null;
    let playing = true;

    const scrollSpeed = 2;

    function moveBackground() {
      gameOffset += scrollSpeed;
      game.style.backgroundPositionY = `${gameOffset}px`;
    }

    function spawnObstacle() {
      const obs = document.createElement('div');
      obs.className = 'obstacle';
      obs.style.left = `${Math.random() * (game.clientWidth - 60)}px`;
      obs.style.top = `${-60}px`;
      game.appendChild(obs);
      moveObstacle(obs);
    }

    function spawnBullet() {
      const bullet = document.createElement('div');
      bullet.className = 'bullet';
      bullet.style.left = `${Math.random() * (game.clientWidth - 20)}px`;
      bullet.style.top = `-30px`;
      game.appendChild(bullet);
      moveBullet(bullet);
    }

    function moveObstacle(obs) {
      function step() {
        if (!playing) return;
        let top = parseFloat(obs.style.top);
        obs.style.top = `${top + scrollSpeed}px`;
        if (top > game.clientHeight) {
          obs.remove();
        } else {
          if (checkCollision(player, obs)) endGame("üí• Wpad≈Çe≈õ na przeszkodƒô!");
          requestAnimationFrame(step);
        }
      }
      step();
    }

    function moveBullet(bullet) {
      function step() {
        if (!playing) return;
        let top = parseFloat(bullet.style.top);
        bullet.style.top = `${top + 6}px`;
        if (top > game.clientHeight) {
          bullet.remove();
        } else {
          if (checkCollision(player, bullet)) endGame("üí£ Trafiony pociskiem!");
          requestAnimationFrame(step);
        }
      }
      step();
    }

    function checkCollision(a, b) {
      const A = a.getBoundingClientRect();
      const B = b.getBoundingClientRect();
      return !(A.right < B.left || A.left > B.right || A.bottom < B.top || A.top > B.bottom);
    }

    function movePlayer(clientX) {
      const gameRect = game.getBoundingClientRect();
      let newX = clientX - gameRect.left - player.clientWidth / 2;
      newX = Math.max(0, Math.min(game.clientWidth - player.clientWidth, newX));
      player.style.left = `${newX}px`;
    }

    function endGame(message) {
      playing = false;
      alert(message);
      location.reload();
    }

    // Spawner
    function loopSpawner() {
      if (!playing) return;
      if (Math.random() < 0.05) spawnObstacle();
      if (Math.random() < 0.07) spawnBullet();
      requestAnimationFrame(loopSpawner);
    }

    // Sterowanie
    game.addEventListener("touchmove", e => {
      movePlayer(e.touches[0].clientX);
    });
    game.addEventListener("mousemove", e => {
      if (e.buttons) movePlayer(e.clientX);
    });

    // Meta po dystansie
    function placeGoal() {
      goal.style.top = "-3000px";
      goal.style.left = `${Math.random() * (game.clientWidth - 60)}px`;
    }
    function moveGoal() {
      if (!playing) return;
      let top = parseFloat(goal.style.top);
      goal.style.top = `${top + scrollSpeed}px`;
      if (top > game.clientHeight) {
        goal.remove();
      } else {
        if (checkCollision(player, goal)) endGame("üèÅ Dotar≈Çe≈õ do mety!");
        requestAnimationFrame(moveGoal);
      }
    }

    placeGoal();
    moveGoal();
    loopSpawner();

    function gameLoop() {
      if (!playing) return;
      moveBackground();
      requestAnimationFrame(gameLoop);
    }

    gameLoop();
  </script>
</body>
</html>
